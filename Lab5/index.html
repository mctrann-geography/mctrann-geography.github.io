<!DOCTYPE html>
<html>
    <head>
        <title> Lab 5 - Layers with Coronovirus</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"crossorigin=""></script>
        <script src="https://mctrann-geography.github.io/Lab5/provinces.js" ></script>
        <script src="https://mctrann-geography.github.io/Lab5/labFour.js" ></script>
        <style type = "text/css">
        html, body {margin: 0; padding: 0; height: 100%;} #map {min-height: 100%}
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script type ="text/javascript">
        
        var map = L.map('map',{
            center: [34.666, 104.9569],
            zoom: 5
        });
        var imagery = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.{ext}', 
            {attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            subdomains: 'abcd',
            minZoom: 0,
            maxZoom: 18,
            ext: 'png'
    });
        var Stamen_Watercolor = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        subdomains: 'abcd',
        minZoom: 1,
        maxZoom: 16,
        ext: 'jpg'
    });
        var canvas = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}', 
                {attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                subdomains: 'abcd',
                minZoom: 0,
                maxZoom: 20,
                ext: 'png'
        }).addTo(map); //default map

        var minValue = 100;
        var minRadius = 5;
        function calcRadius(val){
            return 0.9*Math.pow(val/minValue,.7)*minRadius;
        }
        // var coviddata = new L.geoJson(coviddata).addTo(map);
        var coviddata = new L.geoJson(datas, { //FIXME: datas NOT WORKING CIRCLES AREN'T POPPING UP 
            pointToLayer: function(features, ll){
                return L.circleMarker(ll, {
                    color: '#000000',
                    opacity: 1,
                    weight: 2,
                    fillColor: '#ffff8c',
                    fillOpacity: .5,
                    radius: calcRadius(features.properties.covid)
                });
            }
        })

        var provinces = L.geoJson(data,{style:style}).addTo(map);
        var labFour = L.geoJson(datas).addTo(map);

     
        

        //Layer Control
        var base = {
            "Light Canvas": canvas,
            "Satellite Imagery": imagery,
            "Watercolor": Stamen_Watercolor
        };
        var overlay = {
            "China Provinces": provinces,
            "Infected Areas": labFour
        };
       

        L.control.layers(base,overlay).addTo(map);

        function getColor(value){
            return value >50000000? '#54278f':
            value >25000000? '#756bb1':
            value >10000000? '#9e9ac8':
            value >5000000? '#cbc9e2':
            '#f2f0f7';
        }

        function style(feature){
            return{
                fillColor: getColor(feature.properties.POP10),
                weight: 2,
                opacity: 1,
                color: 'gray',
                fillOpacity: 0.9
            };
        }
    

        </script>
    </body>
</html>